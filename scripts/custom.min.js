function createListener(){"use strict";var a=window.location.href,b=angular.extend.apply(null,a.split(/[#?&]+/g).map(function(a){var b=a.split(/=/),c={};return 2===b.length&&(c[b[0]]=b[1]),c}));"access_token"in b&&(window.opener._SoundcloudCallback(b.access_token),window.close())}function playerService(a,b,c){"use strict";this.audio={stream:null,info:null,isPlaying:!1},this.playPauseSound=function(d){void 0===d&&(d=this.audio.info),d.isPlaying=!d.isPlaying,this.audio.info&&d.stream_url!==this.audio.info.stream_url&&(this.audio.stream.pause(),this.audio.isPlaying=!1,this.audio.stream=null,this.audio.info.isPlaying=!1,a.info("delete old track")),this.audio.isPlaying?(this.audio.stream.pause(),this.audio.isPlaying=!1,a.info("pause")):this.audio.stream?(this.audio.stream.play(),this.audio.isPlaying=!0,a.info("play")):(this.audio.stream=b.load(d.stream_url+"?oauth_token=#{token}".format({token:c.getToken()})),this.audio.stream.play(),this.audio.info=d,this.audio.isPlaying=!0,a.info("play new track"))},this.goTo=function(a){this.audio.stream.progress=a}}function DialogController(a,b,c,d,e){a.track_id=e,a.groups=[],c.getGroups().then(function(b){a.groups=b.data.groups,a.groups.map(function(b){return b.preSelected=c.hasTrack(b.id,a.track_id),b.selected=b.preSelected,b})}),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(){a.groups.forEach(function(e){e.selected&&c.addTrack(e.id,a.track_id,d.getUserId(),a.comment).then(b.hide())})}}function GroupDialog(a,b,c){this.show=function(a){var d=c("sm")||c("xs");b.show({controller:DialogController,locals:{track_id:a},templateUrl:"modules/groups/dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:d})}}function GroupsBackend(a,b){"use strict";var c,d;c="http://ec2-54-201-43-157.us-west-2.compute.amazonaws.com:8000",d={groups:[]},this.getGroups=function(){return a({method:"GET",url:c+"/groups",params:{user_id:b.getUserId()}}).then(function(a){return d.groups=a.data.groups,a})},this.getTracks=function(b){return a.get(c+"/groups/"+b+"/tracks").then(function(a){var b=a.data.tracks.map(function(a){var b,c={};for(b in a.sn)a.sn.hasOwnProperty(b)&&(c[b]=a.sn[b]);for(b in a.sc)a.sc.hasOwnProperty(b)&&(c[b]=a.sc[b]);return c});return b})},this.getMembers=function(b){return a.get(c+"/groups/"+b+"/members").then(function(a){return a.data.members.map(function(a){return a.sc})})},this.addTrack=function(b,d,e,f){return a({method:"POST",url:c+"/groups/"+b+"/tracks",data:{track_id:d,user_id:e,comment:f}})},this.hasTrack=function(a,b){return!!_.find(_.find(d.groups,{id:a}).tracks,{id:b})},this.deleteTrack=function(b,d){return a({method:"DELETE",url:c+"/groups/"+b+"/tracks/"+d})},this.addCommentToTrack=function(b,d,e,f){return a({method:"POST",url:c+"/groups/"+b+"/tracks/"+d+"/comments",data:{user_id:e,text:f}})},this.newGroup=function(b,d,e){return a({method:"POST",url:c+"/groups",data:{name:b,description:d,user_id:e}})},this.invitationCheck=function(d){return a.get(c+"/invitations",{params:{code:d,user_id:b.getUserId()}})},this.inviteToGroup=function(d){var e="welcome"+d+Math.random().toString(36).substring(2,10);return a({method:"POST",url:c+"/invitations",data:{code:e,group_id:d,message:"say hi!",username:b.getMe().first_name}}).then(function(){return e})},this.deleteMember=function(d){return a({method:"DELETE",url:c+"/groups/"+d+"/members/"+b.getUserId()})}}function HistoryBackend(a,b){"use strict";var c;c="http://ec2-54-201-43-157.us-west-2.compute.amazonaws.com:8000",this.getTracks=function(d){return a({method:"GET",url:c+"/history",params:{user_id:b.getUserId(),offset:d}})},this.addTrack=function(d){var e={comment_count:d.comment_count,playback_count:d.playback_count,favoritings_count:d.favoritings_count};return a({method:"POST",url:c+"/history",data:{track_id:d.id,user_id:b.getUserId(),statistics:e}})}}function NextTracks(){"use strict";this.nextTracks=[],this.currentTrackId=null,this.loop=!1,this.addTrack=function(a){_.findIndex(this.nextTracks,["id",a.id])<0&&this.nextTracks.push(a)},this.deleteTrack=function(a,b){if(b||!this.loop)_.remove(this.nextTracks,function(b){return b.id===a});else{var c=_.find(this.nextTracks,{id:a}),d=this.nextTracks.indexOf(c);this.nextTracks.splice(d,1),this.nextTracks.splice(this.nextTracks.length,0,c)}},this.getNextTrack=function(){if(this.nextTracks.length){var a=this.nextTracks[0];return this.currentTrackId=a.id,a}return null},this.getNextTracks=function(){return this.nextTracks},this.getNextTracksIds=function(){return _.map(this.nextTracks,function(a){return a.id})},this.setLoopMode=function(a){this.loop=a},this.isInNextTracks=function(a){return _.find(this.nextTracks,{id:a})}}function PlaylistService(a,b){"use strict";var c={playlists:[],isLoaded:!1};this.mapPlaylist=function(a){var b,d,e=[],f=a.data;for(b=0;b<f.length;b++)for(e.push(f[b]),e[b].track_count_readable=1===f[b].track_count?"1 Track":f[b].track_count+"Tracks",e[b].duration_readable=moment.duration(f[b].duration,"milliseconds").humanize(),e[b].index=b,e[b].showTracks=!1,d=0;d<f[b].length;d++)e[b].tracks[d].isPlaying=!1;return c.playlists=e,c.isLoaded=!0,e},this.getPlaylists=function(d){return d||!c.isLoaded?b.getPlaylists().then(this.mapPlaylist):a(function(a,b){return a(c.playlists)})}}function SoundcloudAPI(a,b,c,d,e){"use strict";var f="https://api.Soundcloud.com",g=f+"/me",h=f+"/users/#{user_id}/",i=f+"/users/#{user_id}/playlists",j=f+"/playlists",k=f+"/users/#{user_id}/favorites",l=f+"/tracks",m=f+"/resolve",n=f+"/users/#{user_id}/followings";this.getMe=function(){return a.get(g,{params:{oauth_token:e.getToken()}})},this.getPlaylists=function(){return a({method:"GET",url:i.format({user_id:e.getUserId()}),params:{oauth_token:e.getToken()}})},this.postPlaylist=function(b,d,f){var g=d?"private":"public",h=_.join(_.map(f,function(a){return"playlist%5Btracks%5D%5B%5D%5Bid%5D="+a}),"&");return a({method:"POST",url:j,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:c({oauth_token:e.getToken(),"playlist[title]":b,"playlist[sharing]":g,"playlist[_resource_id]":null,"playlist[_resource_type]":"playlist"})+"&"+h})},this.putPlaylist=function(b,c){var d=_.map(c,function(a){return{id:a}});return a({method:"PUT",url:j+"/"+b,headers:{"Content-Type":"application/json"},data:{oauth_token:e.getToken(),playlist:{tracks:d}}})},this.getFavorites=function(){return a({method:"GET",url:k.format({user_id:e.getUserId()}),params:{oauth_token:e.getToken()}})},this.getFollowings=function(){return a({method:"GET",url:n.format({user_id:e.getUserId()}),params:{oauth_token:e.getToken()}})},this.getUser=function(b){return a({method:"GET",url:h.format({user_id:b}),params:{oauth_token:e.getToken()}})},this.getTrackSearch=function(b){return a({method:"GET",url:l,params:{oauth_token:e.getToken(),q:b}})},this.getTrackFromUrl=function(b){return a({method:"GET",url:m,params:{url:b,client_id:d.getClientId()}})}}function SoundcloudCredentials(a){"use strict";var b="460ffd8b4467887b82e277fb997d644b",c="8cc5ee91d9e6015109dc93302c43e99c";this.getClientId=function(){return a.indexOf("paszin.github.io")>-1?c:b}}function SoundcloudLogin(a,b,c,d,e,f,g,h,i){"use strict";this.connect=function(){var b,j,k,l;return b=angular.extend({},e),b.client_id=f.getClientId(),b.redirect_uri=g,b.state="code",k=angular.extend({},h),k.left=window.screenX+(window.outerWidth-k.height)/2,k.right=window.screenY+(window.outerHeight-k.width)/2,j=c+"/connect?"+d.toParams(b),window.open(j,"SoundcloudPopup",d.toOptions(k)),l=a.defer(),window._SoundcloudCallback=l.resolve,l.promise.then(i.init),l.promise}}function SoundcloudSessionManager(a,b,c,d){"use strict";this.init=function(b){a.get(d+"/me",{params:{oauth_token:b}}).then(function(a){c.set("user_id",a.data.id),c.set("me",a.data)},angular.noop),c.set("ouath_token",b)},this.getMe=function(){return c.get("me")},this.getToken=function(){return c.get("ouath_token")},this.getUserId=function(){return c.get("user_id")},this.isConnected=function(){return!!c.get("ouath_token")},this.disconnect=function(){b.error("disconnected"),c.set("ouath_token",null)},this.setInvitationCode=function(a){c.set("invitationcode",a)},this.getInvitationCode=function(){return c.get("invitationcode")}}function SoundcloudUtil(){"use strict";function a(a){return this[a]?a+"="+this[a]:null}function b(a){return this[a]?a+"="+encodeURIComponent(this[a]):null}this.toParams=function(a){return Object.keys(a).map(b.bind(a)).join("&")},this.toOptions=function(b){return Object.keys(b).map(a.bind(b)).join(",")}}function AnalyzerAPI(a){"use strict";var b="http://ec2-54-201-43-157.us-west-2.compute.amazonaws.com:9088/upload?track_id=#{track_id}",c="http://developer.echonest.com/api/v4/track/profile?api_key=E2X5BMEC5HNVZDTS1&format=json&id=#{upload_id}&bucket=audio_summary";this.getTrackUpload=function(c){return a({method:"GET",url:b.format({track_id:c})})},this.getTrackProfile=function(b){return a({method:"GET",url:c.format({upload_id:b})})}}function DevController(a,b,c){var d=this,e="https://api.soundcloud.com/tracks/97097113/stream";b.get("modules/devpage/flicflachome.json").then(function(a){d.data=a.data}),b.get("modules/devpage/flicflactrack.json").then(function(a){d.track=a.data}),d.loop=function(){c.audio.stream.progress*d.data.track.duration},c.playPauseSound({stream_url:e}),d["goto"]=function(a){c.goTo(a)}}function NewGroupDialogController(a,b,c,d){"use strict";a.newgroup={},a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(){c.newGroup(a.newgroup.name,a.newgroup.description,d.getUserId()).then(b.hide())}}function AddMembersDialogController(a,b,c,d,e){"use strict";a.url="",c.inviteToGroup(e).then(function(b){a.url=d+"#!/login?code="+b}),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()}}function HistoryController(a,b,c){"use strict";var d,e=0;a.tracks=[],a.hasMoreTracks=!1,a.refresh=function(){a.hasMoreTracks=!1,e=0,a.tracks=[],a.loadMore()},a.loadMore=function(){d=b.getTracks(e),d.then(function(b){a.tracks=_.concat(a.tracks,b.data.tracks),e=b.data.offset+b.data.tracks.length,a.hasMoreTracks=null!==b.data.nextpath})},a.addToPlayNext=function(a){c.addTrack(a)},a.$on("History",a.refresh)}function FavoritesCtrl(a,b){"use strict";var c=b.getFavorites();c.then(function(b){a.favorites=b.data})}function LoginCtrl(a,b,c,d){"use strict";a.mainOptions={sectionsColor:["#100055"],anchors:["WelcomePage"]},b.params.code&&c.setInvitationCode(b.params.code),a.loginWithSoundcloud=function(){d.connect().then(function(){b.go("home")})}}function NextTracksCtrl(a,b,c,d,e){"use strict";a.editMode=!1,a.playlist={name:"Name",isPrivate:!0},a.loop=!1,a.nextTracks=d.nextTracks,a.saveAsPlaylist=function(){e.postPlaylist(a.playlist.name,a.playlist.isPrivate,d.getNextTracksIds()).then(function(b){a.editMode=!1,c.show(c.simple().textContent("Saved as playlist").position("top right").hideDelay(3e3))},function(a){b.error(a),c.show(c.simple().textContent("Fuck, Error, check console for further details").position("top right").hideDelay(3e3))})},a.refresh=function(){a.playlist=d.getNextTracks()},a.$watch("loop",function(a){d.setLoopMode(a)})}function PlaylistsController(a,b,c){"use strict";function d(){b.info("load playlists"),c.getPlaylists().then(function(b){a.playlists=b})}a.playlists=[],a.getPlaylist=function(b){a.playlists[b].showTracks=!a.playlists[b].showTracks},a.$on("Playlists",d)}function SearchCtrl(a,b){"use strict";a.search={input:""},a.searchUrl=function(){b.getTrackFromUrl(a.search.input).then(function(b){"track"===b.data.kind&&(a.results=[b.data])})},a.searchTrack=function(){var c=b.getTrackSearch(a.search.input);c.then(function(b){a.results=b.data})}}function VisualizationCtrl(a,b,c,d,e){"use strict";a.result={status:{message:null},track:{audio_summary:null}},a.loading=!1,a.labels=["danceability","energy","speechiness","acousticness","liveness"],a.data=[[0,0,0,0,0]],a.analyzeTrack=function(){a.uploadTrack()},a.progress={value:0},a.getDownload=function(){return d.audio.info?"http://ec2-54-201-43-157.us-west-2.compute.amazonaws.com:9088/download/"+d.audio.info.id+".mp3":void 0},a.uploadTrack=function(){a.loading=!0;var c=e.getTrackUpload(d.audio.info.id);c.then(function(c){b(function(){a.profileTrack(c.data.echonest_trackid)},1e4)})},a.profileTrack=function(b){e.getTrackProfile(b).then(function(b){a.loading=!1,a.result=b.data.response;var c=b.data.response.track.audio_summary;a.data=[[c.danceability,c.energy,c.speechiness,c.acousticness,c.liveness]]})}}var ApplicationConfiguration=function(){"use strict";var a="Soundcloudfire",b=["ngCookies","ngAnimate","ui.router","ui.bootstrap","ui.utils","ngAudio","ngMaterial","LocalStorageModule","chart.js","fullPage.js","dndLists","ngclipboard"],c=function(b){angular.module(b,[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){"use strict";a.hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$mdThemingProvider",function(a,b){"use strict";a.hashPrefix("!"),b.theme("default").accentPalette("orange",{"default":"400","hue-3":"A100"}).primaryPalette("indigo",{"default":"500","hue-3":"A100"})}]),angular.element(document).ready(function(){"use strict";"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("audioplayer"),ApplicationConfiguration.registerModule("core"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){"use strict";b.otherwise("/login"),a.state("login",{url:"/login?code",templateUrl:"modules/login/login.html",controller:"LoginCtrl"}).state("home",{url:"/home",templateUrl:"modules/core/home.html",controller:"HomeController"}).state("dev",{url:"/dev",templateUrl:"modules/devpage/devpage.html"})}]),ApplicationConfiguration.registerModule("groups"),ApplicationConfiguration.registerModule("history"),ApplicationConfiguration.registerModule("likes"),ApplicationConfiguration.registerModule("login"),ApplicationConfiguration.registerModule("next-tracks"),ApplicationConfiguration.registerModule("playlists"),ApplicationConfiguration.registerModule("search"),ApplicationConfiguration.registerModule("soundcloud"),angular.module("soundcloud").config(createListener),ApplicationConfiguration.registerModule("visualization"),angular.module("audioplayer").service("playerService",playerService),angular.module("groups").service("GroupDialog",GroupDialog),angular.module("groups").service("GroupsBackend",GroupsBackend),angular.module("history").service("HistoryBackend",HistoryBackend),angular.module("next-tracks").service("NextTracks",NextTracks),angular.module("playlists").service("PlaylistService",PlaylistService),angular.module("soundcloud").service("SoundcloudAPI",SoundcloudAPI),angular.module("soundcloud").constant("SoundcloudPopupDefaults",{width:456,height:510,location:1,left:20,top:20,toolbar:"no",scrollbars:"yes"}).constant("SoundcloudRedirectUri",window.location.origin+window.location.pathname).constant("SoundcloudConnectParamBase",{scope:"non-expiring",response_type:"token",display:"popup"}).constant("SoundcloudAPIBase","https://api.Soundcloud.com"),angular.module("soundcloud").service("SoundcloudCredentials",SoundcloudCredentials),angular.module("soundcloud").service("SoundcloudLogin",SoundcloudLogin),angular.module("soundcloud").service("SoundcloudSessionManager",SoundcloudSessionManager),angular.module("core").service("SoundcloudUtil",SoundcloudUtil),angular.module("core").service("AnalyzerAPI",AnalyzerAPI),angular.module("soundcloud").value("Tabs",[{title:"Search",content:"modules/search/search.html",icon:"fa-search"},{title:"Stream",content:"modules/core/empty.template.html",icon:"fa-music"},{title:"Playlists",content:"modules/playlists/playlists.html",icon:"fa-th-list"},{title:"Likes",content:"modules/likes/likes.html",icon:"fa-heart"},{title:"History",content:"modules/history/history.html",icon:"fa-clock-o"},{title:"Next Tracks",content:"modules/next-tracks/next-tracks.html",icon:"fa-hourglass-start"},{title:"Groups",content:"modules/groups/groups.html",icon:"fa-users"},{title:"Analyze",content:"modules/visualization/visualization.html",icon:"fa-magic"}]),angular.module("audioplayer").directive("audioplayer",[function(){"use strict";return{scope:{track:"=track"},controller:function(a,b,c,d,e,f,g){b.full={info:!1},b.playerService=f,b.play=function(a){f.playPauseSound(a)},b.clickWaveform=function(a){var b=document.getElementById("waveformprogress");f.goTo(a.offsetX/b.clientWidth)},b.addToGroup=function(){g.show(b.track.id)}},restrict:"E",templateUrl:"modules/audioplayer/audioplayer.html"}}]),angular.module("soundcloud").directive("track",[function(){"use strict";return{scope:{track:"=track",group:"=group"},controller:function(a,b,c,d,e,f,g,h,i){a.play=function(a){e.playPauseSound(a)},a.addToPlayNext=function(a){g.addTrack(a)},a.group&&a.track&&(a.track.showComments=!1,a.track.newcomment="",a.addComment=function(){a.track.comments.push({text:a.track.newcomment,author_id:f.getUserId(),added_at:moment()}),h.addCommentToTrack(a.group.id,a.track.id,f.getUserId(),a.track.newcomment),a.track.newcomment=""}),a.addToGroup=function(){i.show(a.track.id)},a.findMember=function(b){return _.find(a.group.members,{id:b})}},restrict:"E",templateUrl:"modules/soundcloud/track.html"}}]),angular.module("core").directive("visualization",function(){"use strict";return{restrict:"A",link:function(a,b){var c=document.getElementById("canvas"),d=new createjs.Stage(c),e=new createjs.Shape;e.graphics.beginFill("DeepSkyBlue").drawCircle(0,0,50),e.x=100,e.y=100,d.addChild(e),d.update()}}}),angular.module("soundcloud").filter("artworksize",[function(){"use strict";return function(a,b){return a?a.replace("-large.jpg","-"+b+".jpg"):a}}]),angular.module("soundcloud").filter("beautifyDate",[function(){"use strict";return function(a){return void 0!==a?moment(a).fromNow():void 0}}]),angular.module("soundcloud").filter("beautifyNumber",[function(){"use strict";return function(a){var b=""+a;if(void 0!==a)return a>Math.pow(10,6)?b.substring(0,b.length-6)+"."+b.substring(b.length-5)[0]+"M":a>Math.pow(10,3)?b.substring(0,b.length-3)+"k":a}}]),angular.module("soundcloud").filter("beautifyTitle",[function(){"use strict";return function(a){return void 0!==a?a.replace("Free Download","").replace("OUT NOW !!!","").replace("FREE DOWNLOAD","").replace("[OUT NOW!]",""):void 0}}]),angular.module("core").controller("HomeController",["$rootScope","$scope","$state","$stateParams","$log","SoundcloudSessionManager","SoundcloudAPI","GroupsBackend","NextTracks","Tabs","playerService","HistoryBackend",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";b.tabs=_.filter(j,function(a){return"modules/core/empty.template.html"!==a.content}),b.selectedIndex=2,b.$watch("selectedIndex",function(a){b.$broadcast(b.tabs[a].title)}),b.playerService=k,b.$watch("playerService.audio.stream.progress",function(a){if(1===a){l.addTrack(k.audio.info),i.deleteTrack(k.audio.info.id);var b=i.getNextTrack();b&&k.playPauseSound(b)}}),b.addMeToGroup=function(){h.invitationCheck(f.getInvitationCode()).then(function(a){})},g.getMe().then(function(a){b.me=a.data,f.getInvitationCode()&&b.addMeToGroup()})}]),ApplicationConfiguration.registerModule("dev"),angular.module("dev").controller("DevController",DevController),angular.module("groups").controller("GroupsController",["$scope","$log","$mdDialog","$mdMedia","GroupsBackend","SoundcloudAPI",function(a,b,c,d,e){"use strict";a.groups=[],a.newGroup=function(){var a=d("sm")||d("xs");c.show({controller:NewGroupDialogController,templateUrl:"modules/groups/newGroup-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:a})},a.inviteToGroup=function(a){c.show({controller:AddMembersDialogController,locals:{group_id:a},templateUrl:"modules/groups/addMembers-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0})},a.leaveGroup=function(a){e.deleteMember(a)},a.refresh=function(){e.getGroups().then(function(b){a.groups=b.data.groups})},a.showTracks=function(a){return a.moreInfos=!a.moreInfos,a.sctracks?!0:(e.getTracks(a.id).then(function(b){a.sctracks=b}),void e.getMembers(a.id).then(function(b){a.members=b}))},a.$on("Groups",a.refresh)}]),angular.module("history").controller("HistoryController",HistoryController),angular.module("core").controller("FavoritesCtrl",FavoritesCtrl),angular.module("login").controller("LoginCtrl",LoginCtrl),angular.module("core").controller("NextTracksCtrl",NextTracksCtrl),angular.module("core").controller("PlaylistsController",PlaylistsController),angular.module("core").controller("SearchCtrl",SearchCtrl),angular.module("core").controller("VisualizationCtrl",VisualizationCtrl);